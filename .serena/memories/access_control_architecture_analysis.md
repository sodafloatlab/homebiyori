# アクセス制御アーキテクチャ分析

## 現在の実装（billing_service経由）

### アーキテクチャ
```
各サービス → @require_basic_access() → AccessControlClient → HTTP通信 → billing_service → DynamoDB
```

### メリット
1. **責任分離**: billing_serviceがサブスクリプション管理の単一責任を持つ
2. **ビジネスロジック集約**: 複雑なアクセス制御ロジックをbilling_service内に集約
3. **データ整合性**: サブスクリプション状態の操作と参照が同一サービス内
4. **将来拡張性**: 複雑な課金ロジック（プロモーション、割引等）への対応

### デメリット
1. **ネットワークオーバーヘッド**: 全アクセス制御でHTTP通信が発生
2. **レイテンシ増加**: ネットワークI/O分のレスポンス時間増加
3. **可用性リスク**: billing_serviceダウン時に全サービス影響
4. **スケーラビリティ**: billing_serviceへの集中負荷

## 提案案（共通Layer直接DB参照）

### アーキテクチャ
```
各サービス → @require_basic_access() → 共通Layer → DynamoDB直接参照
```

### メリット
1. **高速レスポンス**: HTTP通信なしでDynamoDB直接アクセス
2. **高可用性**: 単一サービス障害点なし
3. **スケーラビリティ**: 各サービスが独立してDB参照
4. **シンプル性**: ネットワーク層削減

### デメリット
1. **責任分散**: サブスクリプション管理ロジックが分散
2. **データ整合性リスク**: 複数箇所でのDB操作時の競合状態
3. **保守性**: 課金ロジック変更時の複数箇所修正
4. **テスタビリティ**: 各サービスでのDB依存関係増加