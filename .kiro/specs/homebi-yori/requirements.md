# 要件定義書

## はじめに

「ほめびより」は、育児中の親をAIが優しく褒めてくれるWebアプリケーションです。子どもの笑顔の写真や日常の出来事を投稿すると、AIがその内容を分析して親をポジティブにフィードバックします。主役は子供ではなく親であり、押し付けない優しさをテーマとして、育児のやる気や自己肯定感を高めることを目的としています。

## 要件

### 要件1：統合チャット機能

**ユーザーストーリー:** 育児中の親として、トップページでAIロールと今日の気分を選択し、選択したAIと統合的なチャット体験を通じて支援を受けたい

#### 受入基準

1. WHEN ユーザーがトップページにアクセス THEN システムはAIロール選択と今日の気分選択画面を表示する
2. WHEN ユーザーがAIロールを選択 THEN システムは選択されたロールの特性に応じたチャット体験を提供する
3. WHEN ユーザーが今日の気分を選択 THEN システムは「褒めてほしい気分」または「話を聞いてほしい気分」に応じてAIの返答を制御する
4. WHEN ユーザーがチャットで会話 THEN システムは会話内容に応じて努力の可視化機能の木のUIを成長させる
5. WHEN AIが回答を生成 THEN システムは「AIの回答は必ずしも正しくない場合があります」という注意書きを明示する
6. WHEN ユーザーがユーザー登録済み THEN システムは過去の投稿内容や子供の情報を把握した状態でチャットを行う

#### AIロール詳細

- **たまさん（下町のベテランおばちゃん）**
  - テーマカラー：ピンク
  - 感情の受容力が圧倒的、初産・不安定なユーザーの心を溶かす力
  - 人情味と「大丈夫って言ってほしい人」に最適

- **まどか姉さん（バリキャリ共働きママ）**
  - テーマカラー：青
  - 論理的な共感＋自己効力感を高める褒め方
  - 忙しい人、自己評価が低いがんばり屋に響く
  - 「実感のある褒め」のロールモデルとして有効

- **ヒデじい（元教師のやさしい詩人）**
  - テーマカラー：オレンジ
  - 夜に効く、静かな言葉の薬
  - 「行動」ではなく「姿勢」や「人生」に光を当てる
  - 孤独感を和らげ、振り返る時間に寄り添う

#### 今日の気分による制御

**褒めてほしい気分の場合:**
- 常に育児だけでなく「人間としての努力」にも褒めを広げる
- 「寝かしつけおつかれさま」だけでなく、「自分を責めずに一息つけたあなた、ちゃんとえらい」のような表現

**話を聞いてほしい気分の場合:**
- 現実の人間にはこぼしにくい内容でもAIならいつでも話を聞く発散場所として提供
- 共感を第一にユーザーに寄り添うことを最優先
- 「無言でもいい相談」設計：感情アイコンだけでも対応（😔→「その顔…今日はたいへんだったね」）
- 感情の名付けができない人でも受け入れられる設計

#### AI回答制御原則

- **助言禁止原則**: 教育、人生判断などの専門的アドバイスを一切行わず、共感にとどめる
- **比較禁止原則**: 他者との比較・過去のユーザー行動との評価を避ける
- **領域フィルター**: 以下の分野は制限
  - 医療相談: 「ごめんね、わたしにはそれをちゃんと考える力がまだなくて…」
  - DV・虐待に関する疑い: 緊急連絡先を提示する導線へ
  - 離婚・死別などの深刻な人生相談: 「重たい気持ちだね…。それだけ大事なことなんだね」位に留める

#### チャット時のUI要件

1. WHEN ユーザーがチャット中 THEN システムは背景に努力の可視化機能の木をうっすらと表示する
2. WHEN 木が成長 THEN システムはチャット中に穏やかに更新をかけ、AIが成長を補足する
3. WHEN ユーザーがチャット THEN システムはチャット上部にAIロールと今日の気分を表示する
4. WHEN ユーザーが気分を変更したい THEN システムはチャットの途中で気分を切り替える機能を提供する
5. WHEN ユーザーがAIロールを変更したい THEN システムはチャットを一度終了させてからのみ切り替えを可能にする

### 要件2：努力の可視化機能（木の成長UI）

**ユーザーストーリー:** 育児中の親として、チャットでの文字数と感情表現に応じて成長する木のUIを通じて、自分の努力を視覚的に確認したい

#### 受入基準

1. WHEN ユーザーがチャットで文字を入力 THEN システムは文字数に応じて木のUIを成長させる
2. WHEN ユーザーが未登録 THEN システムは常に新芽からスタートする
3. WHEN ユーザーが登録済み THEN システムは文字数を累積させていく
4. WHEN AIが会話から感情を感じ取る THEN システムはAIロールのテーマカラーの光る実を一日一つまで追加する
5. WHEN ユーザーが適当な一言だけつぶやく THEN システムは実を追加しない（感情が込められた内容の場合のみ実を追加）
6. WHEN ユーザーが実をタップ THEN システムはAIが頑張りを褒めてくれる（実ができた時の内容は保存しない）
7. WHEN 時間帯が変わる THEN システムは背景演出を変更する
8. WHEN 季節が変わる THEN システムは季節に応じた演出を変更する

#### 可視化UI詳細

```
┌─────────────────────────────┐
│    　　　　 木は今日も静かに育っています。               │ ← サブヘッダー（固定文言）
│　　　あなたの育児の頑張りが小さな実になっていきます　　　│
├─────────────────────────────┤
│                🌳 家族の木（全画面中央）               　│ ← メインビジュアル
│      実が光る／風で葉が揺れる／鳥が枝にいる              │
│      投稿済：実が光る／未投稿：AIとの会話へ誘導表示     │
├─────────────────────────────┤
│     　　　　　　　　つぶやきの木陰　　　　　　　　　　　 │
│     育児を頑張るあなたをAIが優しく褒めてくれる　　　　   │ 
├─────────────────────────────┤
│ 　　　　　　　　　　　設定    　　　　　　　　　　     │ 
└─────────────────────────────┘
```

### 要件3：設定変更機能

**ユーザーストーリー:** 育児中の親として、褒めのレベルやAIロール、アカウント情報を自分の状況に合わせて変更したい

#### 受入基準

1. WHEN ユーザーが設定画面にアクセス THEN システムは褒めのレベル設定機能を提供する
2. WHEN ユーザーが褒めのレベルを選択 THEN システムは以下のオプションを提供する：
   - ライト：「一言だけ欲しい」
   - スタンダード：「ちょっと励ましてほしい」（デフォルト）
   - ディープ：「ちゃんと向き合って褒めてほしい」
3. WHEN ユーザーがAIロール変更を選択 THEN システムはAIロールを途中で変更できる機能を提供する
4. WHEN ユーザーがアカウント情報変更を選択 THEN システムはニックネームの変更、アカウント情報の削除機能を提供する

### 要件4：ユーザー認証・管理機能

**ユーザーストーリー:** 育児中の親として、安全かつ簡単にアプリを利用し、自分のデータを管理したい

#### 受入基準

1. WHEN ユーザーがアプリにアクセス THEN システムはAmazon Cognitoを使用したGoogleアカウント連携認証機能を提供する
2. WHEN ユーザーがログイン画面にアクセス THEN システムは「Googleでログイン」ボタンを表示してワンクリック認証を可能にする
3. WHEN ユーザーがアカウント作成 THEN システムは子供の情報（名前、生年月日など）を登録できる機能を提供する（本名でなく愛称でもOK）
4. WHEN ユーザーがログイン THEN システムは個人のチャット履歴と努力の可視化データを表示する
5. IF ユーザーがデータ削除を要求 THEN システムは個人データを完全に削除する機能を提供する

### 要件5：メンテナンス機能

**ユーザーストーリー:** サービス管理者として、運用上必要な場合にアプリをメンテナンスモードに切り替えたい

#### 受入基準

1. WHEN システムメンテナンスが必要 THEN 管理者はAWS WAFを使用してアプリケーションレイヤーではなくインフラレベルでメンテナンスページを表示できる
2. WHEN メンテナンスモードが有効 THEN システムは全ユーザーに対してメンテナンス中であることを通知し、適切な復旧予定時間を表示する
3. WHEN メンテナンスが完了 THEN 管理者は迅速にメンテナンスモードを解除してサービスを復旧できる

### 要件6：コスト最適化機能

**ユーザーストーリー:** サービス提供者として、スモールスタートでコストを最小限に抑えながらサービスを運営したい

#### 受入基準

1. WHEN システムがDynamoDBを使用 THEN システムはオンデマンド課金モードで運用する
2. WHEN システムがLambdaを使用 THEN システムは最小限のメモリサイズで運用する（ECS Fargateは使用しない）
3. WHEN システムがAWS Bedrockを使用 THEN システムは効率的なプロンプト設計でAPI呼び出し回数を最適化する
4. WHEN システムがS3を使用 THEN システムは適切なライフサイクルポリシーでストレージコストを最適化する
5. WHEN ユーザーがGoogle認証を利用 THEN システムはユーザーフレンドリーな認証体験を提供してコスト効率を高める

## 実装優先度

### 高優先度（Phase 1）
1. 統合チャット機能（要件1）
2. 努力の可視化機能（要件2）
3. 設定変更機能（要件3）

### 中優先度（Phase 2）
4. ユーザー認証・管理機能（要件4）
5. メンテナンス機能（要件5）

### 低優先度（Future）
- 写真判定機能（要件1の一部）

**注記:** 写真判定は後から実装予定で、まずはチャットでのやり取りから優先して実装する。