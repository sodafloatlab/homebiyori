# 要件定義書

## はじめに

「ほめびより」は、育児中の親をAIが優しく褒めてくれるWebアプリケーションです。子どもの笑顔の写真や日常の出来事を投稿すると、AIがその内容を分析して親をポジティブにフィードバックします。主役は子供ではなく親であり、押し付けない優しさをテーマとして、育児のやる気や自己肯定感を高めることを目的としています。

## 機能要件（カテゴリー別）

## 1. チャット機能

### 1.1 統合チャット機能

**ユーザーストーリー:** 育児中の親として、AIロールと今日の気分を選択し、統合的なチャット体験を通じて支援を受けたい

#### 受入基準
1. WHEN ユーザーがチャット開始 THEN システムはAIロール選択と今日の気分選択画面を表示する
2. WHEN ユーザーがAIロールを選択 THEN システムは選択されたロールの特性に応じたチャット体験を提供する
3. WHEN ユーザーが今日の気分を選択 THEN システムは「褒めてほしい気分」または「話を聞いてほしい気分」に応じてAIの返答を制御する
4. WHEN ユーザーがチャットで会話 THEN システムは会話内容に応じて努力の可視化機能の木のUIを成長させる
5. WHEN AIが回答を生成 THEN システムは「AIの回答は必ずしも正しくない場合があります」という注意書きを明示する
6. WHEN ユーザーが登録済み THEN システムは過去の投稿内容や子供の情報を把握した状態でチャットを行う

### 1.2 AIキャラクターシステム

#### AIロール詳細
- **たまさん（下町のベテランおばちゃん）**
  - テーマカラー：ピンク
  - 感情の受容力が圧倒的、初産・不安定なユーザーの心を溶かす力
  - 人情味と「大丈夫って言ってほしい人」に最適

- **まどか姉さん（バリキャリ共働きママ）**
  - テーマカラー：青
  - 論理的な共感＋自己効力感を高める褒め方
  - 忙しい人、自己評価が低いがんばり屋に響く
  - 「実感のある褒め」のロールモデルとして有効

- **ヒデじい（元教師のやさしい詩人）**
  - テーマカラー：オレンジ
  - 夜に効く、静かな言葉の薬
  - 「行動」ではなく「姿勢」や「人生」に光を当てる
  - 孤独感を和らげ、振り返る時間に寄り添う

### 1.3 感情認識・対応システム

#### 今日の気分による制御
**褒めてほしい気分の場合:**
- 常に育児だけでなく「人間としての努力」にも褒めを広げる
- 「寝かしつけおつかれさま」だけでなく、「自分を責めずに一息つけたあなた、ちゃんとえらい」のような表現

**話を聞いてほしい気分の場合:**
- 現実の人間にはこぼしにくい内容でもAIならいつでも話を聞く発散場所として提供
- 共感を第一にユーザーに寄り添うことを最優先
- 「無言でもいい相談」設計：感情アイコンだけでも対応（😔→「その顔…今日はたいへんだったね」）
- 感情の名付けができない人でも受け入れられる設計

#### 感情アイコン機能
**実装済み感情アイコン:**
- 😊 嬉しい
- 😔 悲しい
- 😤 怒り
- 😰 不安
- 😴 疲れた
- 😅 困った

### 1.4 AI回答制御システム

#### AI回答制御原則
- **助言禁止原則**: 教育、人生判断などの専門的アドバイスを一切行わず、共感にとどめる
- **比較禁止原則**: 他者との比較・過去のユーザー行動との評価を避ける
- **領域フィルター**: 以下の分野は制限
  - 医療相談: 「ごめんね、わたしにはそれをちゃんと考える力がまだなくて…」
  - DV・虐待に関する疑い: 緊急連絡先を提示する導線へ
  - 離婚・死別などの深刻な人生相談: 「重たい気持ちだね…。それだけ大事なことなんだね」位に留める

### 1.5 チャットUI機能

#### チャットヘッダー機能
1. WHEN 1:1チャット THEN システムは選択したAIキャラクターのアバター、名前、モード表示をヘッダーに表示する
2. WHEN グループチャット THEN システムは参加中のAIキャラクターのアバターを重ねて表示し、参加人数を表示する
3. WHEN ユーザーが気分を変更したい THEN システムはヘッダーに「ほめほめ」「聞いて」のトグルボタンを提供する
4. WHEN プレミアムユーザー THEN システムはヘッダーに「ディープ」「ノーマル」のpraise_levelモードトグルボタンを提供する
5. WHEN ディープモードが有効 THEN システムはモード表示に「ディープ」バッジを追加表示する
6. WHEN ユーザーが対話モードを変更したい THEN システムはチャットUIでInteractionMode（praise/listen）の選択機能を提供する

#### チャットメッセージ機能
1. WHEN ユーザーがメッセージを送信 THEN システムはメッセージをチャットエリアに表示し、文字数をカウントする
2. WHEN AIが返答 THEN システムはAIキャラクターのアイコンと名前を付けて返答を表示する
3. WHEN グループチャットのAI返答 THEN システムは各AIキャラクターのテーマカラーでメッセージを色分けして表示する
4. WHEN ユーザーが感情アイコンをタップ THEN システムはその感情をメッセージとして送信し、AIが感情に応じた返答をする
5. WHEN メッセージ表示 THEN システムはメッセージにタイムスタンプを付けて表示する

#### 木の成長状態表示機能
1. WHEN ユーザーがチャット中 THEN システムはチャット画面の上部に木の成長状態をコンパクトに表示する
2. WHEN 木の成長状態が表示される THEN システムは現在の成長段階、次の段階までの文字数、進捗バーを表示する
3. WHEN ユーザーが成長状態をタップ THEN システムは木の詳細表示画面に遷移する

### 1.6 InteractionMode（対話モード）機能

**ユーザーストーリー:** 育児中の親として、今日の気分に応じた対話トーンを選択し、最適なAI応答を受けたい

#### 受入基準
1. WHEN ユーザーがチャットUIでInteractionModeを選択 THEN システムは以下の2つのモードを提供する
   - **praise**: 積極的な肯定・承認・励まし中心
   - **listen**: 共感・理解・寄り添い中心

2. WHEN ユーザーがInteractionModeをpraiseに設定 THEN システムは褒めて欲しい気分に最適化された肯定的な応答を生成する

3. WHEN ユーザーがInteractionModeをlistenに設定 THEN システムは話を聞いて欲しい気分に最適化された共感的な応答を生成する

4. WHEN AIが応答を生成 THEN システムはpraise_levelとInteractionModeの両方を考慮した最適な応答を提供する

5. WHEN ユーザーがInteractionModeを変更 THEN システムは変更内容をDynamoDBユーザープロフィールに永続化する

#### 利用シーン
- **praise**: 自己肯定感を高めたい時、頑張りを認めて欲しい時、励ましが欲しい時
- **listen**: 話を聞いて欲しい時、共感して欲しい時、寄り添って欲しい時

### 1.7 グループチャット機能（プレミアム限定）

#### 受入基準
1. WHEN プレミアムユーザーがグループチャット選択 THEN システムは複数AIキャラクターとの同時チャット機能を提供する
2. WHEN グループチャット中 THEN システムは各AIキャラクターの発言を色分けして表示する
3. WHEN グループチャット中 THEN システムは各AIの特性を活かした異なる視点からの支援を提供する

## 2. 努力の可視化機能

### 2.1 木の成長システム

**ユーザーストーリー:** 育児中の親として、チャットでの文字数と感情表現に応じて成長する木のUIを通じて、自分の努力を視覚的に確認したい

#### 受入基準
1. WHEN ユーザーがチャットで文字を入力 THEN システムは文字数に応じて木のUIを成長させる
2. WHEN ユーザーが未登録 THEN システムは常に新芽からスタートする
3. WHEN ユーザーが登録済み THEN システムは文字数を累積させていく
4. WHEN AIが会話から感情を感じ取る THEN システムはAIロールのテーマカラーの光る実を一日一つまで追加する
5. WHEN ユーザーが適当な一言だけつぶやく THEN システムは実を追加しない（感情が込められた内容の場合のみ実を追加）
6. WHEN ユーザーが実をタップ THEN システムはAIが頑張りを褒めてくれる（実ができた時の内容は保存しない）

### 2.2 ほめの実インタラクション機能

**ユーザーストーリー:** 育児中の親として、木に実った「ほめの実」をタップしてAIからの褒め言葉をもらいたい

#### 受入基準
1. WHEN 木に実が表示される THEN システムは実をタップ可能なインタラクティブ要素として表示する
2. WHEN ユーザーが実をタップ THEN システムは選択した実の情報をモーダルで表示する
3. WHEN 実のモーダルが表示される THEN システムは実の色（AIキャラクターのテーマカラー）、日付、関連するAIキャラクター、会話時のユーザー文言とAI回答を表示する
4. WHEN 実が追加される THEN システムはAIロールのテーマカラーの光る実を一日一つまで追加する
5. WHEN ユーザーが数回のメッセージ交換を行う THEN システムは感情が込められた内容と判断した場合のみ実を追加する（適当な一言では追加しない）

## 3. UI/UX機能

### 3.1 ランディングページシステム

**ユーザーストーリー:** 育児中の親として、初回訪問時にアプリの価値と機能を分かりやすく理解し、すぐに利用を開始したい

#### 受入基準
1. WHEN ユーザーがアプリに初回アクセス THEN システムはアプリの概要と主要機能を魅力的に紹介する
2. WHEN ユーザーがサービス概要を確認 THEN システムは「優しく褒めてくれるAI」「木の成長による可視化」「個人情報保護」の特徴を明示する
3. WHEN ユーザーが利用開始を希望 THEN システムは「チャットを始める」「ログイン」「プレミアムプラン」等の明確なCTAボタンを提供する
4. WHEN ユーザーがフッターを確認 THEN システムは法的文書、サポート情報、運営会社情報へのリンクを提供する

### 3.2 キャラクター選択システム

**ユーザーストーリー:** 育児中の親として、直感的な3段階プロセスで今日の気分とAIキャラクターを選択したい

#### 受入基準
1. WHEN ユーザーがキャラクター選択開始 THEN システムはステッププログレスインジケーターを表示する
2. WHEN ステップ1（気分選択） THEN システムは「褒めてほしい」「聞いてほしい」の2オプションを表示する
3. WHEN ステップ2（キャラクター選択） THEN システムは3人のAIキャラクターを表示し、選択した気分に合うキャラクターに「おすすめ」バッジを表示する
4. WHEN ステップ3（確認） THEN システムは選択内容を確認し、チャット開始ボタンを表示する
5. WHEN ユーザーがプレミアムユーザー THEN システムは確認画面でプレミアム機能の案内を表示する

### 3.3 ナビゲーションシステム

**ユーザーストーリー:** 育児中の親として、アプリ内をスムーズに移動できるナビゲーションを利用したい

#### 受入基準
1. WHEN ユーザーがアプリ内を移動 THEN システムは各ページに適切なナビゲーションヘッダーを表示する
2. WHEN ユーザーが深いページにいる THEN システムはパンくずナビゲーションを表示する
3. WHEN ユーザーが戻るボタンをタップ THEN システムは適切な前のページに戻る
4. WHEN ユーザーがホームボタンをタップ THEN システムはランディングページに移動する
5. WHEN ログインユーザー THEN システムはナビゲーションヘッダーにユーザーメニューを表示する

### 3.4 レスポンシブデザイン機能

**ユーザーストーリー:** 育児中の親として、スマートフォン、タブレット、PCなど異なるデバイスで快適にアプリを利用したい

#### 受入基準
1. WHEN ユーザーがモバイルデバイスでアクセス THEN システムはモバイルファーストデザインで表示する
2. WHEN ユーザーがタブレットでアクセス THEN システムはタブレットに最適化されたレイアウトで表示する
3. WHEN ユーザーがPCでアクセス THEN システムはデスクトップレイアウトで表示する
4. WHEN ユーザーがタッチインタラクション THEN システムはタッチターゲットを適切なサイズで提供する

### 3.5 フィードバックシステム

**ユーザーストーリー:** 育児中の親として、アプリの状態や処理結果を適切なフィードバックで確認したい

#### 受入基準
1. WHEN ユーザーがローディング状態 THEN システムはローディングスピナーと適切なメッセージを表示する
2. WHEN ユーザーの操作が成功 THEN システムはトースト通知で成功を知らせる
3. WHEN ユーザーの操作が失敗 THEN システムはエラートーストで問題を知らせる
4. WHEN トースト表示 THEN システムは一定時間後に自動で非表示にする

## 4. アカウント管理機能

### 4.1 ユーザー認証システム

**ユーザーストーリー:** 育児中の親として、安全かつ簡単にアプリを利用し、自分のデータを管理したい

#### 受入基準
1. WHEN ユーザーがアプリにアクセス THEN システムはAmazon Cognitoを使用したGoogleアカウント連携認証機能を提供する
2. WHEN ユーザーがログイン画面にアクセス THEN システムは「Googleでログイン」ボタンを表示してワンクリック認証を可能にする
3. WHEN ユーザーがアカウント作成 THEN システムはニックネームのみ設定可能とし、個人情報の収集は最小限に留める
4. WHEN ユーザーがログイン THEN システムは個人のチャット履歴と努力の可視化データを表示する
5. IF ユーザーがデータ削除を要求 THEN システムは個人データを完全に削除する機能を提供する

### 4.2 設定変更機能

**ユーザーストーリー:** 育児中の親として、褒めのレベルやAIロール、アカウント情報を自分の状況に合わせて変更したい

#### 受入基準
1. WHEN ユーザーが設定画面にアクセス THEN システムは褒めのレベル設定機能を提供する
2. WHEN ユーザーが褒めのレベルを選択 THEN システムは以下のオプションを提供する：
   - ノーマル：「標準的な褒め方」（デフォルト）
   - ディープ：「深く寄り添った褒め方」（プレミアム限定）
3. WHEN ユーザーがAIロール変更を選択 THEN システムはAIロールを途中で変更できる機能を提供する
4. WHEN ユーザーがアカウント情報変更を選択 THEN システムはニックネームの変更、アカウント削除機能を提供する

### 4.3 アカウント削除機能

**ユーザーストーリー:** ユーザーとして、必要に応じて自分のアカウントとデータを安全かつ確実に削除したい

#### UX設計原則
- **透明性確保**: ユーザーが十分な情報に基づいて決定できる
- **選択の自由**: サブスクリプションとアカウント削除を分離して選択可能
- **段階的プロセス**: 誤操作防止のための段階的確認
- **心理的配慮**: 進捗表示で手続きの負担を軽減

#### 受入基準

**第1段階：サブスクリプション状態確認と選択**
1. WHEN ユーザーが設定画面から「アカウント削除」を選択 THEN システムはアカウント削除フローを開始し、進捗インジケーター（1/3）を表示する
2. WHEN アカウント削除フロー開始 THEN システムはまず現在のサブスクリプション状態を表示する
3. WHEN アクティブなサブスクリプションがある THEN システムは以下の選択肢を提供する：
   - 「サブスクリプションをキャンセルしてアカウントを削除」
   - 「サブスクリプションのみキャンセル（アカウントは残す）」
   - 「アカウントのみ削除（サブスクリプションは別途解約が必要）」
4. WHEN サブスクリプションが無い THEN システムはアカウント削除選択肢のみ表示する
5. WHEN ユーザーが選択肢を選ぶ THEN システムは次の段階に進む

**第2段階：削除内容の詳細説明**
6. WHEN 第2段階表示 THEN システムは進捗インジケーター（2/3）を表示し、削除されるデータの詳細を説明する：
   - チャット履歴
   - 木の成長データ
   - ユーザープロフィール
   - AI設定情報
7. WHEN データ削除説明表示 THEN システムは「この操作は元に戻せません」ことを明確に警告する
8. WHEN 削除データ一覧表示 THEN システムは削除されるデータの詳細一覧を表示する

**第3段階：最終確認と実行**
9. WHEN 第3段階表示 THEN システムは進捗インジケーター（3/3）を表示し、最終確認を求める
10. WHEN 最終確認画面表示 THEN システムはユーザーに「削除」と入力することを求めて誤操作を防ぐ
11. WHEN ユーザーが削除を実行 THEN システムは以下の処理を順次実行する：
    - サブスクリプション解約（選択された場合）
    - DynamoDBからのユーザーデータ完全削除
    - Amazon Cognitoからのユーザーアカウント削除
12. WHEN 削除処理完了 THEN システムは削除完了画面を表示し、自動的にログアウト処理を実行する

**エラーハンドリング**
13. WHEN サブスクリプション解約でエラー THEN システムはエラー内容を表示し、手動解約の案内を提供する
14. WHEN データ削除でエラー THEN システムはサポートへの連絡方法を案内する
15. WHEN 削除処理中にタイムアウト THEN システムは処理状況の確認方法を案内する

**法的・コンプライアンス要件**
16. WHEN 削除処理実行 THEN システムは30日以内にバックアップからもデータを完全削除する
17. WHEN 法的要請でデータ保持が必要 THEN システムは最低限の情報のみを法定期間保持し、ユーザーに通知する

### 4.4 プレミアムプラン管理

#### 受入基準
1. WHEN ユーザーがプレミアムプラン画面にアクセス THEN システムはプレミアム機能の詳細と価格を表示する
2. WHEN ユーザーがプレミアムプラン加入 THEN システムは以下の機能を提供する：
   - グループチャット機能
   - ディープモード（深い褒め方）
   - チャット履歴180日保存（通常30日）
3. WHEN ユーザーがプレミアムプラン解約 THEN システムは解約理由の収集と段階的な解約プロセスを提供する

## 5. プレミアム機能

### 5.1 プレミアムランディングページ

**ユーザーストーリー:** 育児中の親として、プレミアムプランの機能と価格を理解し、加入を検討したい

#### 受入基準
1. WHEN ユーザーがプレミアムページにアクセス THEN システムはプレミアム機能の特徴を魅力的に表示する
2. WHEN ユーザーが機能比較を確認 THEN システムは無料プランとプレミアムプランの機能比較表を表示する
3. WHEN ユーザーが料金情報を確認 THEN システムは月額料金と支払い方法を明示する
4. WHEN ユーザーが加入ボタンをタップ THEN システムは決済手続きへ遷移する

### 5.2 プレミアムプラン解約システム

**ユーザーストーリー:** プレミアムユーザーとして、必要に応じてプランを解約したい

#### 受入基準
1. WHEN ユーザーが解約手続き開始 THEN システムは解約理由選択画面を表示する
2. WHEN ユーザーが理由を選択 THEN システムは任意のフィードバック入力欄を提供する
3. WHEN ユーザーが解約確認 THEN システムは利用できなくなる機能と継続利用可能な機能を明示する
4. WHEN ユーザーが最終解約確定 THEN システムは解約完了画面と今後の案内を表示する

## 6. システム運用機能

### 6.1 メンテナンス機能

**ユーザーストーリー:** サービス管理者として、運用上必要な場合にアプリをメンテナンスモードに切り替えたい

#### 受入基準
1. WHEN システムメンテナンスが必要 THEN 管理者はAWS WAFを使用してアプリケーションレイヤーではなくインフラレベルでメンテナンスページを表示できる
2. WHEN メンテナンスモードが有効 THEN システムは全ユーザーに対してメンテナンス中であることを通知し、適切な復旧予定時間を表示する
3. WHEN メンテナンスが完了 THEN 管理者は迅速にメンテナンスモードを解除してサービスを復旧できる

### 6.2 コスト最適化機能

**ユーザーストーリー:** サービス提供者として、スモールスタートでコストを最小限に抑えながらサービスを運営したい

#### 受入基準
1. WHEN システムがDynamoDBを使用 THEN システムはオンデマンド課金モードで運用する
2. WHEN システムがLambdaを使用 THEN システムは最小限のメモリサイズで運用する（ECS Fargateは使用しない）
3. WHEN システムがAWS Bedrockを使用 THEN システムは効率的なプロンプト設計でAPI呼び出し回数を最適化する
4. WHEN システムがS3を使用 THEN システムは適切なライフサイクルポリシーでストレージコストを最適化する
5. WHEN ユーザーがGoogle認証を利用 THEN システムはユーザーフレンドリーな認証体験を提供してコスト効率を高める

## 7. 法的コンプライアンス機能

### 7.1 法的文書表示機能

**ユーザーストーリー:** サービス利用者として、利用規約やプライバシーポリシーなどの法的文書を確認したい

#### 受入基準
1. WHEN ユーザーが利用規約画面にアクセス THEN システムは最新の利用規約を表示する
2. WHEN ユーザーがプライバシーポリシー画面にアクセス THEN システムは個人情報の取扱いについて詳細を表示する
3. WHEN ユーザーが特定商取引法表記画面にアクセス THEN システムは事業者情報と販売条件を表示する

### 7.2 サポート機能

**ユーザーストーリー:** サービス利用者として、疑問や問題があった時に適切なサポートを受けたい

#### 受入基準
1. WHEN ユーザーがFAQ画面にアクセス THEN システムはよくある質問と回答をカテゴリー別に整理して表示する
2. WHEN ユーザーがお問い合わせ画面にアクセス THEN システムは問い合わせフォームを提供する
3. WHEN ユーザーがお問い合わせ送信 THEN システムは送信完了を通知し、適切な期間内に回答することを告知する
4. WHEN FAQが表示される THEN システムはユーザーが簡単に目的の情報を見つけられるようにアコーディオン形式で表示する

## 実装優先度

### 高優先度（Phase 1）
1. チャット機能（統合チャット、AIキャラクター、感情認識・対応、AI回答制御、チャットUI機能）
2. 努力の可視化機能（木の成長、ほめの実インタラクション）

3. UI/UX機能（ランディングページ、キャラクター選択、ナビゲーション、レスポンシブデザイン、フィードバック）

### 中優先度（Phase 2）
4. アカウント管理機能（ユーザー認証、設定変更、アカウント削除、プレミアムプラン管理）
5. プレミアム機能（プレミアムランディングページ、解約システム）

### 低優先度（Phase 3）
6. システム運用機能（メンテナンス、コスト最適化）
7. 法的コンプライアンス機能（法的文書表示、サポート機能）

**注記:** 
- 個人情報保護の観点から、子供の個人情報（名前、生年月日等）の収集は行わない
- レスポンシブデザインによりモバイルファーストのUI/UX設計を採用
- 実装済み機能：感情アイコン6種類、チャットヘッダー、木の成長状態表示、ほめの実インタラクション
