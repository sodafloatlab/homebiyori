# 実装計画

## フェーズ1: ローカルUI確認用デモアプリ（優先実装）

- [ ] 0. ローカルデモアプリ基盤構築
  - UI/UX確認用のシンプルなデモアプリを構築
  - 認証なしでローカル動作するモックアプリ
  - _目的: 木の成長UIコンセプトの早期検証_

- [ ] 0.1 Next.jsデモプロジェクト初期化
  - Next.js + TypeScript + Tailwind CSSの最小構成
  - ローカル開発環境のセットアップ
  - 基本的なページルーティング設定

- [ ] 0.2 木の成長UIプロトタイプ実装
  - SVGまたはCanvas使用の木の視覚表現
  - 年輪（日数）と実（褒め記録）のモック表示
  - AIロール別実の色分け表示（たまさん：緑、まどか姉さん：赤、ヒデじい：オレンジ）

- [ ] 0.3 基本的なインタラクション実装
  - 実タップ時のふんわり浮遊演出
  - モック褒めメッセージの表示
  - 初回投稿時の手紙演出

- [ ] 0.4 投稿フォームプロトタイプ
  - シンプルな投稿フォーム
  - 投稿時の「静かに喜ぶ」演出
  - ローカルストレージでの状態保存

- [ ] 0.5 AIロール選択UI
  - 3つのキャラクター選択インターフェース
  - キャラクター毎の褒めメッセージサンプル表示

- [ ] 0.6 AIチャット相談機能プロトタイプ（つぶやきの木陰）
  - チャット画面UI実装
  - 感情アイコン送信機能
  - モックAI応答表示
  - 投稿機能への誘導UI実装

## フェーズ2: インフラストラクチャ構築

- [ ] 1. AWS基盤構築
  - Terraformによるインフラストラクチャ構築
  - マイクロサービス型Lambda関数の基盤整備
  - _要件: 全体基盤_

- [ ] 1.1 Terraform環境構築
  - 3層アーキテクチャ（datastore → backend → frontend）の構築
  - S3、DynamoDB、Lambda、API Gateway、Cognito、Bedrockの設定
  - コスト最適化設定の適用

- [ ] 1.2 認証基盤構築（API Gateway + Cognito）
  - Amazon Cognitoユーザープール設定
  - API Gateway Cognito Authorizerの設定
  - Google OAuth連携設定
  - auth-serviceなしのシンプルな認証フロー構築

- [ ] 1.3 共通Lambda Layer構築
  - shared/配下の共通ライブラリ実装
  - DynamoDB、S3操作の共通化
  - JWT解析ヘルパーの実装
  - 共通バリデーション・ログ設定

## フェーズ3: マイクロサービス型バックエンド実装

- [ ] 2. user-service実装
  - ユーザー・子供情報管理サービス構築
  - _要件: 要件6（認証・管理）_

- [ ] 2.1 ユーザープロフィール管理API
  - `GET /users/profile` - プロフィール取得
  - `PUT /users/profile` - プロフィール更新
  - AIロール・褒めレベル設定機能

- [ ] 2.2 子供情報管理API
  - `POST /users/children` - 子供情報登録
  - `GET /users/children` - 子供情報一覧取得
  - `PUT /children/{child_id}` - 子供情報更新
  - `DELETE /children/{child_id}` - 子供情報削除

- [ ] 3. post-service実装
  - 投稿管理サービス構築
  - _要件: 要件1（AI褒め機能）_

- [ ] 3.1 投稿CRUD API実装
  - `POST /posts` - 投稿作成（テキスト・画像）
  - `GET /posts` - 投稿一覧取得
  - `GET /posts/{post_id}` - 投稿詳細取得
  - `DELETE /posts/{post_id}` - 投稿削除

- [ ] 3.2 投稿コンテンツS3保存戦略実装
  - テキスト投稿内容のS3保存
  - DynamoDBにはメタデータのみ保存
  - コスト最適化されたストレージ設計

- [ ] 4. praise-service実装
  - AI褒めメッセージ生成サービス構築
  - _要件: 要件1（AI褒め機能）、要件2（AIロール選択）、要件3（褒めレベル設定）_

- [ ] 4.1 Amazon Bedrock連携実装
  - Claude 3 Haiku APIクライアント実装
  - 効率的なプロンプト設計（約700トークン入力、150トークン出力）
  - コスト最適化されたAPI呼び出し

- [ ] 4.2 AIロール別プロンプト実装
  - たまさん（下町のベテランおばちゃん）: 感情受容力重視・緑テーマ
  - まどか姉さん（バリキャリ共働きママ）: 論理的共感・赤テーマ
  - ヒデじい（元教師のやさしい詩人）: 静かな言葉・オレンジテーマ

- [ ] 4.3 褒めレベル機能実装
  - ライト：簡潔な褒め（1文程度）
  - スタンダード：適度な励まし（2-3文程度）
  - ディープ：詳細な肯定と共感（4-5文程度）

- [ ] 4.4 褒め機能API実装
  - `POST /praise/generate` - AI褒めメッセージ生成
  - `GET /praise/history` - 褒め履歴取得

- [ ] 5. chat-service実装
  - AIチャット相談機能構築（つぶやきの木陰）
  - _要件: 要件5（AIチャット相談機能）_

- [ ] 5.1 チャット機能API実装
  - `POST /chat/send` - チャットメッセージ送信
  - `GET /chat/history` - チャット履歴取得
  - `POST /chat/emotion` - 感情アイコン送信

- [ ] 5.2 AI回答制御原則実装
  - 助言禁止原則：専門的アドバイス回避
  - 比較禁止原則：他者比較回避
  - 領域フィルター：医療相談・DV虐待対応

- [ ] 5.3 機能間相互補完実装
  - 投稿時のチャット誘導機能
  - チャット後の投稿誘導機能
  - 過去投稿履歴を踏まえた親密感のある応答

- [ ] 5.4 感情アイコン対応実装
  - 😔→「その顔…今日はたいへんだったね」
  - 無言でも受け入れる設計
  - 感情の名付けができない人への配慮

- [ ] 6. stats-service実装
  - 統計・可視化データ処理サービス構築
  - _要件: 要件4（努力の可視化機能）_

- [ ] 6.1 木の成長データAPI実装
  - `GET /stats/tree` - 木の成長データ取得
  - 育児日数に応じた年輪成長計算
  - AIロール別実の色データ生成

- [ ] 6.2 マイルストーン機能実装
  - `GET /stats/milestones` - マイルストーン情報取得
  - 育児の節目イベント管理
  - 成長段階別の特別演出

- [ ] 7. image-service実装
  - 画像アップロード・処理サービス構築
  - _要件: 要件1（AI褒め機能）の画像投稿対応_

- [ ] 7.1 画像アップロード機能実装
  - `POST /images/upload` - 画像アップロード
  - S3への安全なファイルアップロード
  - 画像最適化・リサイズ処理

- [ ] 7.2 画像メタデータ管理実装
  - `GET /images/{image_id}` - 画像メタデータ取得
  - 画像の個人情報除去
  - GDPR準拠のデータ管理

## フェーズ4: フロントエンド本格実装

- [ ] 8. 認証連携フロントエンド実装
  - API Gateway + Cognito認証の統合
  - _要件: 要件6（ユーザー認証・管理）_

- [ ] 8.1 AWS Amplify Auth統合
  - Google OAuth認証フロー実装
  - JWT トークン管理
  - 認証状態の管理

- [ ] 8.2 認証済み状態での機能連携
  - 各APIエンドポイントとの認証連携
  - ユーザー固有データの取得・表示
  - セキュアなAPI通信

- [ ] 9. 投稿機能フロントエンド実装
  - 投稿作成・管理UIの構築
  - _要件: 要件1（AI褒め機能）_

- [ ] 9.1 投稿フロー設計実装
  - 投稿→お祝い→手紙→実の出現フロー
  - 「静かに喜んでくれる」演出（拍手アニメーション）
  - 手紙を閉じる際の木の実出現

- [ ] 9.2 投稿フォーム実装
  - テキスト投稿フォーム
  - 画像アップロード対応
  - 表現に困った場合のチャット誘導メッセージ

- [ ] 10. AIチャット機能フロントエンド実装
  - つぶやきの木陰UI構築
  - _要件: 要件5（AIチャット相談機能）_

- [ ] 10.1 チャット画面UI実装
  - AIロール選択インターフェース
  - リアルタイムチャット風UI
  - 感情アイコン送信機能

- [ ] 10.2 チャット誘導・連携実装
  - 投稿後のチャット誘導
  - チャット後の投稿誘導
  - 過去履歴を踏まえた親密感のある表示

- [ ] 11. 木の成長UI本格実装
  - 可視化機能の完全版構築
  - _要件: 要件4（努力の可視化機能）_

- [ ] 11.1 木の成長段階実装
  - 生後期間に応じた6段階の成長表示
  - 年輪と実の動的表示
  - 子供の名前刻印機能

- [ ] 11.2 AIロール別実の色分け実装
  - たまさん：緑、まどか姉さん：赤、ヒデじい：オレンジ
  - 光る実と光らない実の区別
  - 新規追加実の特別エフェクト

- [ ] 11.3 インタラクション実装
  - 実タップ時のふんわり浮遊演出
  - 褒めメッセージの空中表示
  - 水彩風背景エフェクト

- [ ] 12. ユーザー設定画面実装
  - プロフィール・設定管理UI構築
  - _要件: 要件2（AIロール選択）、要件3（褒めレベル設定）、要件6（ユーザー認証・管理）_

- [ ] 12.1 AIロール選択画面実装
  - 3つのキャラクター選択UI
  - キャラクター特性の視覚的表現
  - リアルタイムプレビュー機能

- [ ] 12.2 プロフィール管理実装
  - ユーザー情報編集
  - 子供情報管理（複数対応）
  - 褒めレベル設定

- [ ] 13. レスポンシブデザイン実装
  - デバイス対応UIの構築
  - _要件: 要件8（レスポンシブデザイン）_

- [ ] 13.1 モバイルファーストUI実装
  - スマートフォン最適化
  - タッチ操作最適化
  - モバイル専用レイアウト

- [ ] 13.2 タブレット・デスクトップ対応
  - 画面サイズ別レイアウト調整
  - レスポンシブグリッド実装
  - マルチデバイス対応テスト

## フェーズ5: 運用・監視・最適化

- [ ] 14. 監視・ログ設定
  - New Relic監視システム構築
  - _要件: 運用全般_

- [ ] 14.1 アプリケーション監視実装
  - フロントエンド：Browser Agent
  - バックエンド：Python Agent
  - インフラ：Infrastructure Agent

- [ ] 14.2 パフォーマンス監視・アラート設定
  - エラー率・レスポンス時間監視
  - リソース使用率監視
  - コスト超過アラート

- [ ] 15. セキュリティ・コンプライアンス実装
  - セキュリティ機能の強化
  - _要件: 要件6（ユーザー認証・管理）、要件9（メンテナンス）_

- [ ] 15.1 WAFメンテナンスモード実装
  - AWS WAFによるメンテナンス制御
  - メンテナンス画面の実装
  - 管理者アクセス制御

- [ ] 15.2 データ保護・プライバシー実装
  - 画像メタデータ除去
  - GDPR準拠データ削除機能
  - セキュリティログ管理

- [ ] 16. パフォーマンス最適化
  - アプリケーション最適化
  - _要件: 要件10（コスト最適化）_

- [ ] 16.1 フロントエンド最適化実装
  - Next.js Dynamic Import
  - 画像最適化（WebP対応）
  - キャッシュ戦略実装

- [ ] 16.2 バックエンド最適化実装
  - Lambda関数メモリ最適化
  - DynamoDB GSI設計最適化
  - Bedrock API効率化

- [ ] 17. CI/CD・デプロイ自動化
  - 自動デプロイパイプライン構築
  - _要件: 運用全般_

- [ ] 17.1 GitHub Actions設定
  - テスト・ビルド・デプロイ自動化
  - セキュリティスキャン統合
  - 環境別デプロイ戦略

- [ ] 17.2 ブルーグリーンデプロイ実装
  - 無停止デプロイ機能
  - 自動ロールバック機能
  - デプロイ監視・検証

## コスト目標とマイルストーン

**想定コスト**：月間100ユーザーで約$11.71（85%コスト削減達成）

**主要マイルストーン**：
- フェーズ1完了：UIコンセプト確定
- フェーズ2完了：インフラ基盤完成
- フェーズ3完了：バックエンドAPI完成
- フェーズ4完了：フロントエンド機能完成
- フェーズ5完了：本番運用開始

**技術特記事項**：
- マイクロサービス型Lambda関数（6個）での効率的構成
- auth-service不要のシンプルな認証アーキテクチャ
- API Gateway + Cognitoによる認証認可の完結
- 共通Lambda Layerによるコード共有とメンテナンス性向上